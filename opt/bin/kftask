#!/bin/bash

if [ $# -lt 1 ]; then
    find /work/workspace/kefu/callback -name "*.properties" | grep ".properties" | grep -v "application.properties"  | grep -v "project.properties" | grep -v "application-test.properties" | grep -v "pom.properties" | grep -v "target/classes" | awk -F'/' '{print $NF}' | awk -F'.' '{print $1}'
    exit 
else
    task=$1
    prop=$(find /work/workspace/kefu/callback -name "*.properties" | grep ".properties" | grep -v "application.properties"  | grep -v "project.properties" | grep -v "application-test.properties" | grep -v "pom.properties" | grep -v "target/classes" | grep $task)
    echo $prop

    project=${prop%%/src/main*}
    cmd=$(ls $project/target/*.jar)
    echo $cmd

    java -jar $cmd --config-factory=org.apache.samza.config.factories.PropertiesConfigFactory --config-path=file://$prop
fi
